# 오봇 현재 작업 상태 (에이전트 기록 없이 이어서 작업할 때 참고)

> 이 파일은 **어디까지 했는지** 빠르게 파악하기 위한 요약입니다.  
> 새 채팅/파일을 열어서 에이전트 기록이 없어졌을 때 여기를 보면 됩니다.

---

## 지금 있는 브랜치

- **브랜치:** `feat/clob-sdk-integration`
- **마지막 커밋:** `fix(clob): 프록시 레이스 컨디션 수정 + minor 정리`

---

## 이 브랜치에서 한 일 (요약)

1. **CLOB SDK 연동**  
   Opinion.trade CLOB(중앙 호가창)로 주문 넣는 흐름 연동.

2. **자전거래(Wash trade) 흐름**  
   - 계정 2개( Maker / Taker )로 1시간 마켓에 LIMIT 주문 → Taker로 매칭 → 체결 폴링 → 미체결 시 양쪽 취소.  
   - `.env`에는 **PK만** 넣으면 됨 (`OPINION_CLOB_PK_1`, `OPINION_CLOB_PK_2`).  
   - 자세한 검토는 `docs/CLOB_WASH_TRADE_REVIEW.md` 참고.

3. **프록시**  
   - 프록시 레이스 컨디션 수정 반영됨.  
   - 문제 생기면 `docs/PROXY_TROUBLESHOOTING.md` 참고.

4. **삭제된 파일**  
   - `account.py`, `market.py`, `validator.py`, `index.html`, `main.js`, `style.css` 등  
     → 오봇은 `app.py` + `templates/opinion.html` + `static/` 구조로 정리된 상태.

5. **새로 추가된 문서/스크립트**  
   - `docs/CLOB_WASH_TRADE_REVIEW.md` — 자전거래 구현 검토  
   - `docs/OPINION_EOA_AND_WALLET.md`  
   - `docs/PROXY_TROUBLESHOOTING.md`  
   - `core/opinion_geo.py`  
   - `scripts/test_opinion_proxy.py`

---

## 아직 커밋 안 된 변경 (git status 기준)

- **수정됨:** `.cursorrules`, `.env.example`, `app.py`, `config.py`,  
  `core/opinion_account.py`, `opinion_clob_order.py`, `opinion_config.py`,  
  `templates/opinion.html`, `static/js/opinion.js`,  
  `docs/COLLAB_WORKFLOW.md`, `docs/OPINION_OPENAPI.md` 등  
- **삭제됨:** `account.py`, `index.html`, `main.js`, `style.css`, `market.py`, `validator.py`  
- **추가됨(미추적):** `core/opinion_geo.py`,  
  `docs/CLOB_WASH_TRADE_REVIEW.md`, `docs/OPINION_EOA_AND_WALLET.md`,  
  `docs/PROXY_TROUBLESHOOTING.md`, `scripts/test_opinion_proxy.py`

→ 다음에 할 일: **정리해서 커밋**하거나, **특정 기능만 이어서 작업**하면 됩니다.

---

## 실시간 자전거래 (최근 수정)

- **문제:** 한쪽이 주문을 올려도 반대쪽이 바로 받지 못하면 실패하는 구조.
- **변경:** Maker 직후 2초 대기 제거 → 0.2초만 대기 후 Taker 전송. Taker는 **MARKET 주문**으로 즉시 체결 시도. 체결 폴링 1.5초 → 0.4초.
- **설정:** `config.py` / `.env` — `POST_MAKER_DELAY_SEC`, `USE_TAKER_MARKET_ORDER`, `WASH_TRADE_POLL_INTERVAL_SEC` (자세한 건 `docs/CLOB_WASH_TRADE_REVIEW.md` §6).

## 다음에 할 수 있는 것

- **커밋 정리:** 위 변경을 논리 단위로 나눠서 커밋 (예: 실시간 자전거래 / CLOB 연동 / 문서 등).
- **실거래 검증:** 소액으로 자전거래 한 번 돌려 보기 → `order_id` 파싱·체결 상태가 API와 맞는지 확인 (`CLOB_WASH_TRADE_REVIEW.md` 4절 참고).
- **Claude Code 리뷰:**  
  `feat/clob-sdk-integration` 브랜치의 `git diff`를 보고 리뷰/PR 요청.

---

## 실행 방법 (로컬)

```bash
cd /Users/han/Downloads/O-Bot
source venv/bin/activate   # Windows: venv\Scripts\activate
python3 app.py
```

브라우저: `http://localhost:5001` → 접속 암호 입력 후 Opinion 대시보드.

.env에 `OPINION_API_KEY`, `OPINION_PROXY`, `SECRET_KEY` (그리고 CLOB용이면 `OPINION_CLOB_PK_1`, `OPINION_CLOB_PK_2`) 필요.
